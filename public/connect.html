<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connect Device - SKYBOTZ</title>
<style>
body{margin:0;font-family:Poppins,sans-serif;background:#0d1117;color:white;display:flex;justify-content:center;align-items:center;height:100vh;}
.card{width:380px;background:#161b22;padding:25px;border-radius:12px;box-shadow:0 0 20px rgba(0,255,150,0.2);}
h2{text-align:center;margin-bottom:15px;}
input{width:100%;padding:12px;background:#0d1117;border:1px solid #333;color:white;border-radius:8px;margin-bottom:10px;}
button{width:48%;padding:12px;border:none;color:white;font-weight:bold;border-radius:8px;cursor:pointer;transition:.2s;}
.btn-green{background:#03e97b;}
.btn-blue{background:#0099ff;}
button:hover{opacity:.8;}
.btn-row{display:flex;justify-content:space-between;margin-top:10px;}
#qrImage{margin-top:10px;width:100%;border-radius:8px;}
</style>
</head>
<body>
<div class="card">
    <h2>Connect WhatsApp Bot</h2>
    <input type="email" id="email" placeholder="Masukan Email (@gmail.com)">
    <input type="text" id="user" placeholder="Masukan Username">
    <input type="password" id="pass" placeholder="Masukan Password">
    <input type="password" id="cpass" placeholder="Confirm Password">
    <input type="number" id="bot" placeholder="Nomor Bot (62...)">
    <input type="number" id="owner" placeholder="Nomor Owner (62...)">
    
    <div class="btn-row">
        <button class="btn-green" onclick="getPairingCode()">Pairing Code</button>
        <button class="btn-blue" onclick="checkQR()">QR WhatsApp</button>
    </div>
    <img id="qrImage" src="" alt="">
</div>

<script>
function checkInputs(){
    let email = document.getElementById("email").value;
    let pass = document.getElementById("pass").value;
    let cpass = document.getElementById("cpass").value;
    let bot = document.getElementById("bot").value;
    let owner = document.getElementById("owner").value;
    if(!email.endsWith("@gmail.com")) return false;
    if(pass !== cpass) return false;
    if(!bot.startsWith("62")) return false;
    if(!owner.startsWith("62")) return false;
    return true;
}

async function getPairingCode(){
    if(!checkInputs()) return alert("Cek input Anda!");
    const res = await fetch('http://localhost:3000/pairing');
    const data = await res.json();
    if(data.error) return alert(data.error);
    alert("Pairing Code: " + data.code);
    sessionStorage.setItem("connected","true");
    window.location.href = "dashboard.html";
}

async function checkQR(){
    if(!checkInputs()) return alert("Cek input Anda!");
    const res = await fetch('http://localhost:3000/status');
    const data = await res.json();
    if(data.qr) document.getElementById("qrImage").src = data.qr;
    sessionStorage.setItem("connected","true");
    window.location.href = "dashboard.html";
}
</script>
</body>
</html>
